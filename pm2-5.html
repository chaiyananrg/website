<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายงานค่าฝุ่น PM 2.5 - ทุกจังหวัด</title>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: "Poppins", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f8ff; /* สีพื้นหลังฟ้าอ่อน */
    }
    header {
      background: linear-gradient(135deg, #32CD32, #1E90FF); /* เขียว-ฟ้า */
      color: white;
      padding: 20px;
      text-align: center;
      border-radius: 0 0 30px 30px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      font-size: 2em;
      margin: 0;
    }
    header p {
      font-size: 1em;
      margin: 5px 0 0;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: separate;
      border-spacing: 0 10px; /* ระยะห่างระหว่างแถว */
      background: white;
      border-radius: 10px;
    }
    table th, table td {
      padding: 15px;
      text-align: center;
      border: none;
    }
    table th {
      background: #4CAF50;
      color: white;
      border-radius: 10px 10px 0 0;
      font-size: 1.2em;
    }
    table td {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      font-size: 1em;
    }
    .level-good {
      background: #90EE90;
    }
    .level-moderate {
      background: #1E90FF;
      color: white;
    }
    .level-unhealthy-sensitive {
      background: #FFA500;
      color: white;
    }
    .level-unhealthy {
      background: #FF4500;
      color: white;
    }
    .level-very-unhealthy {
      background: #8B008B;
      color: white;
    }
    footer {
      text-align: center;
      padding: 20px;
      background: #333;
      color: white;
      margin-top: 20px;
      border-radius: 30px 30px 0 0;
    }
    footer p {
      margin: 0;
    }
    .icon {
      font-size: 24px;
      margin-right: 10px;
    }
    .icon-good {
      color: #32CD32; /* เขียว */
    }
    .icon-moderate {
      color: #1E90FF; /* ฟ้า */
    }
    .icon-unhealthy-sensitive {
      color: #FFA500; /* ส้ม */
    }
    .icon-unhealthy {
      color: #FF4500; /* แดง */
    }
    .icon-very-unhealthy {
      color: #8B008B; /* ม่วง */
    }
  </style>
</head>
<body>
  <header>
    <h1>รายงานค่าฝุ่น PM 2.5</h1>
    <p>อัปเดตล่าสุด: <span id="update-time"></span></p>
  </header>

  <table>
    <thead>
      <tr>
        <th>จังหวัด</th>
        <th>ค่า PM 2.5</th>
        <th>ระดับความอันตราย</th>
      </tr>
    </thead>
    <tbody id="pm-table">
      <tr>
        <td colspan="3">กำลังโหลดข้อมูล...</td>
      </tr>
    </tbody>
  </table>

  <footer>
    <p>ข้อมูลจาก OpenWeatherMap API</p>
  </footer>

  <script>
    const provinces = [
      "กรุงเทพมหานคร", "กระบี่", "กาญจนบุรี", "กาฬสินธุ์", "กำแพงเพชร", "ขอนแก่น",
      "จันทบุรี", "ฉะเชิงเทรา", "ชลบุรี", "ชัยนาท", "ชัยภูมิ", "ชุมพร",
      "เชียงราย", "เชียงใหม่", "ตรัง", "ตราด", "ตาก", "นครนายก",
      "นครปฐม", "นครพนม", "นครราชสีมา", "นครศรีธรรมราช", "นครสวรรค์", "นนทบุรี",
      "นราธิวาส", "น่าน", "บึงกาฬ", "บุรีรัมย์", "ปทุมธานี", "ประจวบคีรีขันธ์",
      "ปราจีนบุรี", "ปัตตานี", "พะเยา", "พังงา", "พัทลุง", "พิจิตร",
      "พิษณุโลก", "เพชรบุรี", "เพชรบูรณ์", "แพร่", "ภูเก็ต", "มหาสารคาม",
      "มุกดาหาร", "แม่ฮ่องสอน", "ยโสธร", "ยะลา", "ร้อยเอ็ด", "ระนอง",
      "ระยอง", "ราชบุรี", "ลพบุรี", "ลำปาง", "ลำพูน", "เลย",
      "ศรีสะเกษ", "สกลนคร", "สงขลา", "สตูล", "สมุทรปราการ", "สมุทรสงคราม",
      "สมุทรสาคร", "สระแก้ว", "สระบุรี", "สิงห์บุรี", "สุโขทัย", "สุพรรณบุรี",
      "สุราษฎร์ธานี", "สุรินทร์", "หนองคาย", "หนองบัวลำภู", "อ่างทอง", "อำนาจเจริญ",
      "อุดรธานี", "อุตรดิตถ์", "อุทัยธานี", "อุบลราชธานี", "อื่นๆ"
    ];

    const apiKey = "41c1aef7e4e507e010fb4e2705e6f0b6";
    const tableBody = document.getElementById("pm-table");
    const updateTime = document.getElementById("update-time");

    async function fetchAirQuality() {
      tableBody.innerHTML = "";
      const now = new Date();
      updateTime.textContent = now.toLocaleString();

      for (const province of provinces) {
        try {
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/air_pollution?lat=13.7563&lon=100.5018&appid=${apiKey}`
          );
          const data = await response.json();

          const pm25 = data.list[0].components.pm2_5;
          const level = getPmLevel(pm25);

          const row = `
            <tr class="${level.class}">
              <td>${province}</td>
              <td>${pm25}</td>
              <td><span class="icon ${level.icon}"></span>${level.label}</td>
            </tr>
          `;
          tableBody.innerHTML += row;
        } catch (error) {
          Swal.fire({
            icon: 'error',
            title: 'เกิดข้อผิดพลาด',
            text: `ไม่สามารถโหลดข้อมูลของ ${province} ได้`,
          });
        }
      }
    }

    function getPmLevel(pm25) {
      if (pm25 <= 50) return { label: "ดี", class: "level-good", icon: "icon-good" };
      if (pm25 <= 100) return { label: "ปานกลาง", class: "level-moderate", icon: "icon-moderate" };
      if (pm25 <= 150) return { label: "มีผลกระทบต่อบางคน", class: "level-unhealthy-sensitive", icon: "icon-unhealthy-sensitive" };
      if (pm25 <= 200) return { label: "อันตราย", class: "level-unhealthy", icon: "icon-unhealthy" };
      return { label: "อันตรายมาก", class: "level-very-unhealthy", icon: "icon-very-unhealthy" };
    }

    fetchAirQuality();
  </script>
</body>
</html>
