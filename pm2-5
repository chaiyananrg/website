<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายงานค่าฝุ่น PM 2.5 - ทุกจังหวัด</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    header {
      background: #4CAF50;
      color: white;
      padding: 20px;
      text-align: center;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background: white;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    table th {
      background: #4CAF50;
      color: white;
    }
    .level-good {
      background: #90EE90;
    }
    .level-moderate {
      background: #FFD700;
    }
    .level-unhealthy-sensitive {
      background: #FFA500;
    }
    .level-unhealthy {
      background: #FF4500;
      color: white;
    }
    .level-very-unhealthy {
      background: #8B008B;
      color: white;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: #333;
      color: white;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>รายงานค่าฝุ่น PM 2.5 - ทุกจังหวัด</h1>
    <p>อัปเดตล่าสุด: <span id="update-time"></span></p>
  </header>

  <table>
    <thead>
      <tr>
        <th>จังหวัด</th>
        <th>ค่า PM 2.5</th>
        <th>ระดับความอันตราย</th>
      </tr>
    </thead>
    <tbody id="pm-table">
      <tr>
        <td colspan="3">กำลังโหลดข้อมูล...</td>
      </tr>
    </tbody>
  </table>

  <footer>
    <p>ข้อมูลจาก OpenWeatherMap API</p>
  </footer>

  <script>
    const provinces = [
      "กรุงเทพมหานคร", "กระบี่", "กาญจนบุรี", "กาฬสินธุ์", "กำแพงเพชร", "ขอนแก่น", 
      "จันทบุรี", "ฉะเชิงเทรา", "ชลบุรี", "ชัยนาท", "ชัยภูมิ", "ชุมพร", 
      "เชียงราย", "เชียงใหม่", "ตรัง", "ตราด", "ตาก", "นครนายก", 
      "นครปฐม", "นครพนม", "นครราชสีมา", "นครศรีธรรมราช", "นครสวรรค์", "นนทบุรี", 
      "นราธิวาส", "น่าน", "บึงกาฬ", "บุรีรัมย์", "ปทุมธานี", "ประจวบคีรีขันธ์", 
      "ปราจีนบุรี", "ปัตตานี", "พะเยา", "พังงา", "พัทลุง", "พิจิตร", 
      "พิษณุโลก", "เพชรบุรี", "เพชรบูรณ์", "แพร่", "ภูเก็ต", "มหาสารคาม", 
      "มุกดาหาร", "แม่ฮ่องสอน", "ยโสธร", "ยะลา", "ร้อยเอ็ด", "ระนอง", 
      "ระยอง", "ราชบุรี", "ลพบุรี", "ลำปาง", "ลำพูน", "เลย", 
      "ศรีสะเกษ", "สกลนคร", "สงขลา", "สตูล", "สมุทรปราการ", "สมุทรสงคราม", 
      "สมุทรสาคร", "สระแก้ว", "สระบุรี", "สิงห์บุรี", "สุโขทัย", "สุพรรณบุรี", 
      "สุราษฎร์ธานี", "สุรินทร์", "หนองคาย", "หนองบัวลำภู", "อ่างทอง", "อำนาจเจริญ", 
      "อุดรธานี", "อุตรดิตถ์", "อุทัยธานี", "อุบลราชธานี", "อื่นๆ"
    ];

    const apiKey = "41c1aef7e4e507e010fb4e2705e6f0b6";
    const tableBody = document.getElementById("pm-table");
    const updateTime = document.getElementById("update-time");

    // ฟังก์ชันดึงข้อมูล PM 2.5
    async function fetchAirQuality() {
      tableBody.innerHTML = ""; // ล้างตารางก่อนโหลดข้อมูลใหม่
      const now = new Date();
      updateTime.textContent = now.toLocaleString();

      for (const province of provinces) {
        try {
          // ใช้ API ที่ดึงข้อมูลพิกัดเดียว
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/air_pollution?lat=13.7563&lon=100.5018&appid=${apiKey}`
          );
          const data = await response.json();

          const pm25 = data.list[0].components.pm2_5;
          const level = getPmLevel(pm25);

          const row = `
            <tr class="${level.class}">
              <td>${province}</td>
              <td>${pm25}</td>
              <td>${level.label}</td>
            </tr>
          `;
          tableBody.innerHTML += row;
        } catch (error) {
          console.error(`Error fetching data for ${province}:`, error);
        }
      }
    }

    // ฟังก์ชันประเมินระดับความอันตราย
    function getPmLevel(pm25) {
      if (pm25 <= 50) return { label: "ดี", class: "level-good" };
      if (pm25 <= 100) return { label: "ปานกลาง", class: "level-moderate" };
      if (pm25 <= 150) return { label: "มีผลกระทบต่อบางคน", class: "level-unhealthy-sensitive" };
      if (pm25 <= 200) return { label: "อันตราย", class: "level-unhealthy" };
      return { label: "อันตรายมาก", class: "level-very-unhealthy" };
    }

    // เริ่มต้นโหลดข้อมูล
    fetchAirQuality();
  </script>
</body>
</html>
